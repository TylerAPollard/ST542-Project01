---
title: "DeSIRE Consultation Report"
author: "Tyler Pollard"
date: "2024-07-02"
header-includes:
  - \usepackage{float}
  - \usepackage{indentfirst}
  - \usepackage{caption}
  - \usepackage{array}
  - \floatplacement{figure}{H}
  - \usepackage{amsmath}
  - \usepackage{multicol}
  - \usepackage{makecell}
  - \usepackage{cancel}
geometry: "left=1in,right=1in,top=1in,bottom=1in"
fontsize: 12pt
linestretch: 1.0
indent: true
output: 
  bookdown::pdf_document2:
    number_sections: true
    fig_caption: TRUE
---

<!-- Font Sizes List -->
<!-- \tiny -->
<!-- \scriptsize -->
<!-- \footnotesize -->
<!-- \small -->
<!-- \normalsize -->
<!-- \large -->
<!-- \Large -->
<!-- \LARGE -->
<!-- \huge -->
<!-- \Huge -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60), tidy = TRUE)
```

```{r load libraries}
# Load Libraries ----
## Data Reading 
library(data.table) # Read csv in tibble format
library(readxl) # Read xlsx 

## Data Manipulation
library(stringr) # Manipulate strings
library(plyr) # Produce summary tables/data.frames

## Plotting
library(scales)
library(RColorBrewer)
library(patchwork)

## Tables
library(gt)
library(gtsummary)

## Data Analysis
library(likert)
library(psych)
library(agricolae)
library(lme4)
library(lmtest)
library(car)
library(emmeans)
library(betareg)
library(caret)
library(jtools)
library(blorr)

## Bayesian Data Analysis
library(DescTools)
library(rstanarm)
library(brms)
library(posterior)
library(bayesplot)
library(BayesFactor)

## Load this package last to reduce package conflictions with dplyr
library(tidyverse) 
```

# Abstract {-}


# Introduction
## Purpose
Engaging middle school students in rural North Carolina in STEM education presents a critical challenge. These students often face unique barriers, including limited access to resources, fewer educational opportunities, and less exposure to STEM based careers. This gap in engagement and access can suppress curiosity, limit career aspirations, and hinder the development of crucial skills needed in an advancing technological world. To overcome these challenges, innovative educational programs specifically designed to their needs are necessary. These programs aim to spark interest and provide practical learning experiences that enhance both cognitive outcomes like STEM knowledge and practices, and non-cognitive outcomes such as STEM interest, identity, and self-efficacy.

DeSIRE is a partnership between the College of Engineering and the Friday Institute for Educational Innovation at North Carolina State University (NCSU), the NC Mathematics and Science Education Network Pre-College Program (MSEN), the Edgecombe County Public Schools (ECPS) district, and local advanced manufacturing industry. The Friday Institute (FI) serves as the primary research partner for the DeSIRE project.

## Program design
The aim of the DeSIRE project is to create community-based engineering design experiences for underserved middle school students (grades 6-8) from rural NC aimed to improve their cognitive (STEM content knowledge and career awareness) and non-cognitive (interest, self-efficacy and STEM identity) outcomes, and ultimately lead to their increased participation in STEM fields, particularly engineering.

The DeSIRE program involves middle school students from West Edgecombe and Phillips through mentoring and instructional activities centered around the engineering design process, specifically aligned with careers in the region's advanced manufacturing industries. By engaging students in project-based learning in school and providing enrichment activities during weekends and summer breaks, the initiative seeks to expand their understanding of STEM career paths, emphasizing opportunities in advanced manufacturing within their local communities.

DeSIRE will accomplish the overarching project goal by: 1) developing a 3-part Engineering Design elective course for grade levels 6-8, 2) incorporating a mentoring component whereby undergraduate engineering students from the Minority Engineering Program (MEP) at NC State and STEM professionals from industry serve as mentors to the middle school students during the course and 3) providing In-depth STEM Experiences where students engage in supplemental STEM enrichment activities outside of the classroom such as industry and university tours.

## Research Questions
1. How and to what degree does the engineering design-focused program impact students’ disciplinary- based knowledge and practices in STEM and career awareness?

2. How and to what degree does the engineering design-focused program impact students’ STEM interest, STEM identity, and STEM self-efficacy?

3. How and to what degree does the engineering design-focused program impact teacher STEM content and pedagogical knowledge and awareness of STEM 

# Methods
## Data
```{r Load Data}
load("Data/S-STEM/Cleaned S-STEM Survey Data.RData")
load("Analyses/STEM Career Awareness/AllCareerAwareness.RData")
```

```{r Sample Sizes}
SampleSize_data <- SSTEMsurvey_data |>
  select(
    SchoolYear,
    Semester,
    YearSemester,
    School,
    Grade,
    Gender,
    Gender2,
    Race,
    Race2
  )

SampleSizes <- apply(SampleSize_data, 2, table)
SampleSizesPerc <- lapply(SampleSizes, function(x){round(x/nrow(SampleSize_data)*100, 2)})
```

\begin{table}[H]
  \begin{center}
    \caption{Demographics of the middle school students in the S-STEM survey data}
    \begin{tabular}{llcc}
    \Xhline{4\arrayrulewidth}
Variable & Category & Frequency & Percentage (\%) \\ \hline
SchoolYear & 2020-2021 & `r SampleSizes$SchoolYear[1]` & `r SampleSizesPerc$SchoolYear[1]` \\
     & 2022-2023 & `r SampleSizes$SchoolYear[2]` & `r SampleSizesPerc$SchoolYear[2]` \\ \cline{2-4}
Semester & Fall & `r SampleSizes$Semester[1]` & `r SampleSizesPerc$Semester[1]` \\
         & Spring & `r SampleSizes$Semester[2]` & `r SampleSizesPerc$Semester[2]` \\ \cline{2-4}
YearSemester & `r names(SampleSizes$YearSemester[1])` & `r SampleSizes$YearSemester[1]` & `r SampleSizesPerc$YearSemester[1]` \\
         & `r names(SampleSizes$YearSemester[2])` & `r SampleSizes$YearSemester[2]` & `r SampleSizesPerc$YearSemester[2]` \\
         & `r names(SampleSizes$YearSemester[3])` & `r SampleSizes$YearSemester[3]` & `r SampleSizesPerc$YearSemester[3]` \\ \hline
School & `r names(SampleSizes$School[1])` & `r SampleSizes$School[1]` & `r SampleSizesPerc$School[1]` \\
       & `r names(SampleSizes$School[2])` & `r SampleSizes$School[2]` & `r SampleSizesPerc$School[2]` \\ \hline
Grade & `r names(SampleSizes$Grade[1])` & `r SampleSizes$Grade[1]` & `r SampleSizesPerc$Grade[1]` \\ 
      & `r names(SampleSizes$Grade[2])` & `r SampleSizes$Grade[2]` & `r SampleSizesPerc$Grade[2]` \\
      & `r names(SampleSizes$Grade[3])` & `r SampleSizes$Grade[3]` & `r SampleSizesPerc$Grade[3]` \\ \hline
Gender & `r names(SampleSizes$Gender[1])` & `r SampleSizes$Gender[1]` & `r SampleSizesPerc$Gender[1]` \\
       & `r names(SampleSizes$Gender[2])` & `r SampleSizes$Gender[2]` & `r SampleSizesPerc$Gender[2]` \\
       & `r names(SampleSizes$Gender[3])` & `r SampleSizes$Gender[3]` & `r SampleSizesPerc$Gender[3]` \\ \cline{2-4}
Gender2 & `r names(SampleSizes$Gender2[1])` & `r SampleSizes$Gender2[1]` & `r SampleSizesPerc$Gender2[1]` \\
       & `r names(SampleSizes$Gender2[2])` & `r SampleSizes$Gender2[2]` & `r SampleSizesPerc$Gender2[2]` \\ \hline
Race & American Indian/Alaska Native & `r SampleSizes$Race[1]` & `r SampleSizesPerc$Race[1]` \\
     & Black/African American & `r SampleSizes$Race[2]` & `r SampleSizesPerc$Race[2]` \\
     & Hispanic/Latino & `r SampleSizes$Race[3]` & `r SampleSizesPerc$Race[3]` \\
     & Multiracial & `r SampleSizes$Race[4]` & `r SampleSizesPerc$Race[4]` \\
     & Other & `r SampleSizes$Race[5]` & `r SampleSizesPerc$Race[5]` \\
     & White/Caucasian & `r SampleSizes$Race[6]` & `r SampleSizesPerc$Race[6]` \\ \cline{2-4}
Race2 & Black/African American & `r SampleSizes$Race2[1]` & `r SampleSizesPerc$Race2[1]` \\
     & Hispanic/Latino & `r SampleSizes$Race2[2]` & `r SampleSizesPerc$Race2[2]` \\
     & White/Caucasion & `r SampleSizes$Race2[4]` & `r SampleSizesPerc$Race2[4]` \\
     & Other & `r SampleSizes$Race2[3]` & `r SampleSizesPerc$Race2[3]` \\ \hline
Total & & \textbf{82} & \textbf{100} \\ \Xhline{4\arrayrulewidth}
    \end{tabular}
  \end{center}
\end{table}

## Analysis of Variance

$$
\begin{aligned}
Y_{ijk} &= \mu + \alpha_i + \beta_j + E_{ijk} \text{ where } E_{ijk} \overset{iid}\sim N(0, \sigma^2) \\
i &= 1,2 = a, \text{ for factor School}\\
j &= 1,2 = b, \text{ for factor Student} \\
k &= 1, ..., n_{ij} \text{ for \# students per group} \\
\end{aligned}
$$

\begin{table}[H]
\begin{center}
\caption{ANOVA Table}
\begin{tabular}{c|cccc}
Source & Sum Sq & Df & F value & Pr(>F)  \\ \hline
Student & 1559.8 & 1 & 28.414 & 2.53e-07 \\
School & 8658.2 & 1 & 157.735 & < 2.2e-16 \\
Residuals & 11472.2 & 209
\end{tabular}
\end{center}
\end{table}

## Logistical Regression Modeling
```{r}
# \text{log}\left( \frac{\pi_i}{1-\pi_i} \right) &= \beta_0 + \sum_{j=1}^p X_{ij}\beta_j \\
# i &= 1, ..., n = 70, \text{ for number of students} \\
# j &= 1, ..., p = 4,  \text{ for p parameters}
```
$$
\begin{aligned}
E(Y_i|\textbf{X}_i) &= P(Y_i = 1) = \pi_i \\
\text{logit}(\pi_i) &= \text{log}\left( \frac{\pi_i}{1-\pi_i} \right) = \text{log}(\text{Odds}_i) \text{ for } i = 1, ..., n = 70, \text{ for number of students} \\
\text{log}(\text{Odds}_i) &= \beta_0 + \beta_1\text{SchoolPhillipsMiddleSchool}_i + \beta_2\text{Grade7th}_i \\
&+ \beta_3\text{Grade8th}_i + \beta_4\text{Gender2NotMale}_i + \beta_5\text{Race2Black\_AfricanAmerican}_i \\ 
&+ \beta_6\text{Race2White\_Caucasian}_i + \beta_7\text{Race2Hispanic\_Latino}_i \\
\end{aligned}
$$


## Non-parametric tests of group distributions


## Bayesian regression modeling

# Results
## Impact on disciplinary-based knowledge through EOG science test


## STEM students' career awareness
### Scientists
```{r STEM Career Awareness Scientist Load}
load(file = "Analyses/STEM Career Awareness/CareerAwarenessScientist.RData")
```

\begin{table}[H]
\begin{center}
\caption{Model Summary for Scientist Career Awareness}
\vspace{-.125in}
```{r Model Summary for Scientist Career Awareness, fig.cap = "Model Summary for Scientist Career Awareness"}
#### Table Summary ----
awarenessSci_final_sumTable <- awarenessSci_final |>
  tbl_regression(exponentiate = TRUE,
                 conf.level = 0.95, add_estimate_to_reference_rows = TRUE, ) |>
  # Stats
  add_global_p(type = 2, test.statistic = "LR", quiet = FALSE) |> # add global p-value
  add_n(location = c("label","level")) |> # add number of obs
  add_significance_stars(pattern = "{p.value}{stars}",
                         hide_ci = FALSE,
                         hide_p = FALSE) |>
  # Format Values
  bold_p() |> # bold p-values under a given threshold (default 0.05)
  bold_p(t = 0.05) |> # now bold q-values under the threshold of 0.10
  bold_labels() |>
  italicize_levels() |>
  as_gt()


## Format gt output
awarenessSci_final_sumTable |>
  tab_style(style = cell_text(align = "center"),
            locations = cells_source_notes()) |>
  tab_style(style = cell_text(style = "italic"),
            locations = cells_row_groups(groups = everything()))
```
\end{center}
\end{table}

```{r STEM Career Awareness Science Plot, fig.align="center"}
awarenessSci_plot_Gender <- ggplot(data = awarenessSci_emmeans_df) +
  #geom_col(aes(x = Gender, y = prob, fill = "Scientists")) +
  geom_col(aes(x = Gender, y = prob, fill = prob)) +#, fill = "#E41A1C") +
  geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL, x = Gender),
                width = 0.25, linewidth = 1) +
  # geom_text(aes(x = rev(Gender), y = -0.05, label = paste0("n = ", n)),
  #           size = rel(4.5)) +
  #scale_fill_manual(name = NULL, values = c("#E41A1C")) +
  # c("#E41A1C" "#377EB8" "#4DAF4A" "#984EA3")
  scale_x_discrete(name = "Gender2",
                   limits = rev(awarenessSci_emmeans_df$Gender)) +
  scale_y_continuous(limits = c(0,1), 
                     breaks = seq(0,1, 0.1), minor_breaks = seq(0,1, 0.05),
                     #expand = expansion(add = c(0.04,0.04))
  ) +
  scale_fill_gradient2(name = NULL, limits = c(0,1), #guide = "colourbar",
                       low = "#F28F8F", mid = "#E2E2E2", high = "#64BF64",
                       midpoint = 0.5) +
  labs(
    title = "DeSIRE Students' Career Awareness of Scientists by Aggregated Gender",
    subtitle = "95% Confidence Interval about Expected Probability of Career Awareness",
    y = "Probability of Scientist Career Awareness"
  ) +
  coord_flip() +
  theme_bw() +
  theme(
    panel.grid.major.y = element_blank(),
    plot.title.position = "panel",
    plot.title = element_text(size = rel(1.3)),
    plot.subtitle = element_text(size = rel(1.1), face = "italic"),
    axis.title = element_text(size = rel(1.1)),
    axis.text.y = element_text(size = rel(1.1), hjust = 0.5),
    axis.text.x = element_text(size = rel(1.1))
  )
awarenessSci_plot_Gender
```

### Engineers
```{r STEM Career Awareness Engineers Load}
```

### Mathematicians
```{r STEM Career Awareness Mathematicians Load}
```

### Technologists
```{r STEM Career Awareness Technologists Load}
```

## Students' STEM interest


## Students' STEM identity


## Students' STEM self-efficacy


# Conclusion

# Appendix A: R Code to clean S-STEM data {-}
```{r Clean S-STEM Data R code, echo = TRUE, eval = FALSE}
# Load Libraries ----
## Data Reading 
library(data.table) # Read csv in tibble format
library(readxl) # Read xlsx 

## Data Manipulation
library(stringr) # Manipulate strings
library(plyr) # Produce summary tables/data.frames

## Data Analysis
library(likert)
library(lme4)
library(lmtest)
library(car)
library(emmeans)
library(betareg)
library(caret)

## Bayesian Data Analysis
library(DescTools)
library(rstanarm)
library(brms)
library(posterior)
library(bayesplot)
library(BayesFactor)

## Plotting
library(patchwork)

## Load this package last to reduce package conflictions with dplyr
library(tidyverse) 

# %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
# S-STEM SURVEY ===========================================================
# %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
## Read in Data ----

### Questions ----
SSTEMsurvey_questions <- read_excel(
  "Data/S-STEM+-+DeSIRE_June+6,+2024_09.13.xlsx", 
  n_max = 1)
SSTEMsurvey_questions <- SSTEMsurvey_questions |> unlist()
view(SSTEMsurvey_questions)
SSTEMsurvey_colnames <- names(SSTEMsurvey_questions)

### Survey Data ----
SSTEMsurvey_data_withQuestions <- read_excel(
  "Data/S-STEM+-+DeSIRE_June+6,+2024_09.13.xlsx",
  na = c("", NA), 
  skip = 1)
SSTEMsurvey_data_withCodes <- SSTEMsurvey_data_withQuestions
colnames(SSTEMsurvey_data_withCodes) <- SSTEMsurvey_colnames

## Clean Data ----

### Select and Rename ----
SSTEMsurvey_data <- SSTEMsurvey_data_withCodes |>
  select(
    StartDate,
    Progress,
    Finished,
    str_which(SSTEMsurvey_colnames, pattern = "Q")
  ) |>
#### Socio-Demographics ----
rename(
  "StartDate" = StartDate,
  "School" = Q2,
  "Grade" = Q3,
  "TeacherID" = Q37,
  "TeacherName" = Q37_4_TEXT,
  "SemesterYear" = Q36,
  "FirstName" = Q15,
  "MiddleName" = Q16,
  "LastName" = Q17,
  "BirthDate" = Q18,
  "StudentID" = Q20,
  "Gender" = Q21,
  "GenderOther" = Q21_6_TEXT,
  "Race" = Q22,
  "RaceOther" = Q22_8_TEXT
)

#### Self-Efficacy ----

## Math, Science, and Engineering and Tech Constructs
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q6_", 
                                          replacement = "Math_Q")
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q23_",
                                          replacement = "Science_Q")
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q24_", 
                                          replacement = "EngTech_Q")

#### Identity ----

## 21st Century Learning Construct
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q26_", 
                                          replacement = "Learning_Q")

#### Interest ----

## Your Future Items
interestAreas <- c(
  "Physics",
  "Environmental Work",
  "Biology and Zoology",
  "Veterinary Work",
  "Mathematics",
  "Medicine",
  "Earth Science",
  "Computer Science",
  "Medical Science",
  "Chemistry",
  "Energy",
  "Engineering"
)

colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q28_", 
                                          replacement = "Interest_Q")

#### Career Awareness ----

## More about you Items
careerAwarenessAreas <- c(
  "Scientists",
  "Engineers",
  "Mathematicians",
  "Technologists"
)

colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q35_", 
                                          replacement = "Awareness_Q")

#### Other Questions ----

##### Expectations ----
expectationAreas <- c(
  "English",
  "Math",
  "Science"
)

colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data),
                                          pattern = "Q29_", 
                                          replacement = "Expectations_Q")

##### Take Advanced Classes ----
advancedClassesAreas <- c(
  "Mathematics",
  "Science"
)

colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q31_", 
                                          replacement = "Classes_Q")

##### College ----
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data),
                                          pattern = "Q32", 
                                          replacement = "PlanCollege")
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data),
                                          pattern = "Q33", 
                                          replacement = "InterestCollege")
colnames(SSTEMsurvey_data) <- str_replace(colnames(SSTEMsurvey_data), 
                                          pattern = "Q34", 
                                          replacement = "FirstCollege")

#### SAVE CHECKPOINT ----
save(SSTEMsurvey_data, file = "Data/S-STEM Survey Data Renamed.RData")

### Recode ----
load(file = "Data/S-STEM Survey Data Renamed.RData")

#### Date ----
SSTEMsurvey_data2 <- SSTEMsurvey_data |>
  mutate(
    Date = as_date(StartDate),
    Year = year(Date),
    Semester = ifelse(semester(Date) == 1, "Spring", "Fall"),
    SchoolYear = ifelse(Semester == "Fall", 
                        paste0(Year, "-", Year+1),
                        paste0(Year-1, "-", Year)),
    YearSemester = paste0(Year, Semester)
  ) |>
  select(
    StartDate,
    Date,
    Year,
    SchoolYear,
    Semester,
    YearSemester,
    everything()
  )

#### Factors of Interest ----
SSTEMsurvey_data3 <- SSTEMsurvey_data2 |>
  mutate(
    School = factor(School,
                    labels = c("West Edgecombe Middle School", 
                               "Phillips Middle School")),
    Grade = factor(Grade,
                   labels = c("6th", "7th", "8th")),
    Gender = factor(Gender,
                    labels = c("Male", "Female", "Other")),
    Race = factor(Race,
                  levels = c(1,2,3,4,5,6,7,8),
                  labels = c("American Indian_Alaska Native",
                             "Asian",
                             "Black_African American",
                             "Native Hawaiian_Other Pacific Islander",
                             "White_Caucasian",
                             "Hispanic_Latino",
                             "Multiracial",
                             "Other")),
    Race2 = factor(Race,
                   levels = c("American Indian_Alaska Native",
                              "Asian",
                              "Black_African American",
                              "Native Hawaiian_Other Pacific Islander",
                              "White_Caucasian",
                              "Hispanic_Latino",
                              "Multiracial",
                              "Other"),
                   labels = c("Other",
                              "Other",
                              "Black_African American",
                              "Other",
                              "White_Caucasian",
                              "Hispanic_Latino",
                              "Other",
                              "Other")) 
  ) |>
  select(
    1:21,
    Race2,
    everything()
  )

SSTEMsurvey_data <- SSTEMsurvey_data3

### SAVE DATA ----
save(SSTEMsurvey_data,
     SSTEMsurvey_colnames,
     SSTEMsurvey_questions,
     file = "Data/Cleaned S-STEM Survey Data.RData")
```
